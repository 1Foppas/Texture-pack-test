<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Texture Pack Test v0.2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .toggle {
      cursor: pointer;
      font-weight: bold;
      display: inline-block;
      margin-top: 10px;
      margin-bottom: 5px;
    }
    .sub-options {
      margin-left: 20px;
      display: none;
    }
    label {
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <h1>Texture Pack Test</h1>

  <!-- Always included files -->
  <input type="checkbox" id="base" data-path="" checked disabled>
  <label for="base">Base pack (pack.mcmeta, pack.png)</label><br>

  <!-- Ores -->
  <span class="toggle" onclick="toggleSub('ores-sub', this)">Ores ▼</span>
  <div id="ores-sub" class="sub-options">
    <input type="checkbox" id="ores" data-path="assets/minecraft/textures/block">
    <label for="ores">All Ores</label><br>
  </div>

  <!-- Items -->
  <input type="checkbox" id="items" data-path="assets/minecraft/textures/item">
  <label for="items">Items</label><br>

  <!-- Customs -->
  <span class="toggle" onclick="toggleSub('customs-sub', this)">Customs ▼</span>
  <div id="customs-sub" class="sub-options">

    <!-- Custom Enchantments -->
    <span class="toggle" onclick="toggleSub('custom-enchants-sub', this)">Custom Enchantments ▼</span>
    <div id="custom-enchants-sub" class="sub-options">

      <input type="checkbox" id="armor-models" data-path="assets/minecraft/optifine/cit/customenchantments/armor_layer">
      <label for="armor-models">Armor Models</label><br>

      <input type="checkbox" id="armor-icons" data-path="assets/minecraft/optifine/cit/customenchantments/armor">
      <label for="armor-icons">Armor Icons</label><br>

      <input type="checkbox" id="rest" data-path="assets/minecraft/optifine/cit/customitems">
      <label for="rest">Rest</label><br>

    </div>

    <!-- Custom Items (empty for now) -->
    <span class="toggle" onclick="toggleSub('custom-items-sub', this)">Custom Items ▼</span>
    <div id="custom-items-sub" class="sub-options">
      <!-- You can add checkboxes here later -->
    </div>
  </div>

  <br><br>
  <button onclick="downloadPack()">Download Texture Pack</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script>
    function toggleSub(id, el) {
      const sub = document.getElementById(id);
      if (sub.style.display === "none" || sub.style.display === "") {
        sub.style.display = "block";
        el.textContent = el.textContent.replace("▼","▲");
      } else {
        sub.style.display = "none";
        el.textContent = el.textContent.replace("▲","▼");
      }
    }

    async function fetchFileList(path) {
      const url = path
        ? `assets/minecraft/${path}/filelist.json`
        : "filelist.json";
      try {
        const res = await fetch(url);
        if (!res.ok) return [];
        return res.json();
      } catch {
        return [];
      }
    }

    async function addFolder(zip, folderPath, basePath="") {
      const list = await fetchFileList(folderPath);
      for (const file of list) {
        if (file.endsWith("/")) {
          const subFolder = file.slice(0, -1);
          await addFolder(zip.folder(subFolder), folderPath + "/" + subFolder, basePath + subFolder + "/");
        } else {
          const fileUrl = folderPath + "/" + file;
          try {
            const res = await fetch(fileUrl);
            if (res.ok) {
              const blob = await res.blob();
              zip.file(basePath + file, blob);
            }
          } catch (e) {
            console.error("Failed to fetch", fileUrl, e);
          }
        }
      }
    }

    async function downloadPack() {
      const zip = new JSZip();

      // Always include base
      const baseFiles = ["pack.mcmeta", "pack.png"];
      for (const f of baseFiles) {
        const res = await fetch(f);
        if (res.ok) {
          zip.file(f, await res.blob());
        }
      }

      // Add selected folders
      const checks = document.querySelectorAll("input[type=checkbox]:checked:not(:disabled)");
      for (const c of checks) {
        const path = c.dataset.path;
        if (path) {
          await addFolder(zip, path, path + "/".split("/").slice(2).join("/"));
        }
      }

      const content = await zip.generateAsync({ type: "blob" });
      saveAs(content, "texture pack test.zip");
    }
  </script>
</body>
</html>

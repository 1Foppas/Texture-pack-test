
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tp test v0.203.1</title>
  <style>
    .sub-options {
      margin-left: 20px;
      display: none;
    }
    .toggle {
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Texture pack test</h1>

<!-- Main ores group -->
<input type="checkbox" id="ores">
<span class="toggle" onclick="toggleSub('ores-sub', this)">Ores ▶</span>
<div id="ores-sub" class="sub-options"></div>
<br>

  <span class="toggle" onclick="toggleSub('customs-sub', this)">Customs ▶</span>
  <div id="customs-sub" class="sub-options">
  
     <span class="toggle" onclick="toggleSub('custom-enchants-sub', this)">Custom Enchantments ▶</span>
    <div id="custom-enchants-sub" class="sub-options">

       <input type="checkbox" id="Carmor-models">
      <label for="Carmor-models">Armor Models</label><br>

       <input type="checkbox" id="Carmor-icons">
      <label for="Carmor-icons">Armor Models</label><br>

       <input type="checkbox" id="Ctools">
      <label for="Ctools">Tools</label>

<!-- Items group -->
<br>
<label>
  <input type="checkbox" id="item">
  Include item textures (with subfolders)
</label>
<br>
<label>
  <input type="checkbox" id="tools">
  Include tools textures (only /tools/)
</label>


  <br><br>
  <button id="downloadBtn">Download Texture Pack</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script>
function toggleSub(id, el) {
  const container = document.getElementById(id);
  if (container.style.display === "none" || container.style.display === "") {
    container.style.display = "block";
    el.textContent = el.textContent.replace("▶", "▼");
  } else {
    container.style.display = "none";
    el.textContent = el.textContent.replace("▼", "▶");
  }
}
    // load filelist for ores sub-options
    async function loadSubOptions(path, containerId, groupId) {
      try {
        const resp = await fetch(path + "/filelist.json");
        if (!resp.ok) return;
        const files = await resp.json();
        const container = document.getElementById(containerId);

        files.forEach(file => {
          if (file.endsWith(".png")) {
            const id = groupId + "-" + file.replace(/\W/g, "");
            const displayName = file.replace(".png", "").replace(/_/g, " ");
            const label = document.createElement("label");
            label.innerHTML = `<input type="checkbox" class="${groupId}-child" id="${id}" value="${file}"> ${displayName}<br>`;
            container.appendChild(label);
          }
        });

        // link parent checkbox to children
        const parent = document.getElementById(groupId);
        parent.addEventListener("change", () => {
          const children = document.querySelectorAll("." + groupId + "-child");
          children.forEach(ch => ch.checked = parent.checked);
        });

        // if any child changes, uncheck parent if not all are selected
        container.addEventListener("change", () => {
          const children = document.querySelectorAll("." + groupId + "-child");
          parent.checked = [...children].every(ch => ch.checked);
        });

      } catch (e) {
        console.error("Error loading suboptions", e);
      }
    }

    async function addFiles(zip, path, files) {
      for (const file of files) {
        const resp = await fetch(path + "/" + file);
        if (resp.ok) {
          const blob = await resp.blob();
          zip.file(path + "/" + file, blob);
        }
      }
    }

async function addFilesFromFolder(zip, basePath, includeSubfolders = false) {
  const resp = await fetch(`${basePath}/filelist.json`);
  if (!resp.ok) return;

  const files = await resp.json();

  for (const f of files) {
    if (f === "filelist.json") continue;

    if (f.endsWith("/")) {
      // subfolder
      if (includeSubfolders) {
        await addFilesFromFolder(zip, `${basePath}/${f.replace(/\/$/, "")}`, includeSubfolders);
      }
    } else {
      // file
      const fileResp = await fetch(`${basePath}/${f}`);
      if (fileResp.ok) {
        const blob = await fileResp.blob();
        zip.file(`${basePath}/${f}`, blob);
      }
    }
  }
}


    document.getElementById("downloadBtn").addEventListener("click", async () => {
      const zip = new JSZip();

      // always add base pack files
      const baseFiles = ["pack.mcmeta", "pack.png"];
      for (const baseFile of baseFiles) {
        const resp = await fetch(baseFile);
        if (resp.ok) {
          const blob = await resp.blob();
          zip.file(baseFile, blob);
        }
      }

      // Ores: add selected files from block/ (or whole folder if parent checked)
      const oresParent = document.getElementById("ores");
      const oresChildren = document.querySelectorAll(".ores-child:checked");
      if (oresParent.checked && oresChildren.length === 0) {
        const resp = await fetch("assets/minecraft/textures/block/filelist.json");
        const files = await resp.json();
        await addFiles(zip, "assets/minecraft/textures/block", files.filter(f => f.endsWith(".png")));
      } else {
        for (const ch of oresChildren) {
          const file = ch.value;
          const resp = await fetch("assets/minecraft/textures/block/" + file);
          if (resp.ok) {
            const blob = await resp.blob();
            zip.file("assets/minecraft/textures/block/" + file, blob);
          }
        }
      }

// Items (whole folder, with subfolders)
if (document.getElementById("item").checked) {
  await addFilesFromFolder(zip, "assets/minecraft/textures/item", true);
}

// Tools only (just /item/tools/, no recursion)
if (document.getElementById("tools").checked) {
  await addFilesFromFolder(zip, "assets/minecraft/textures/item/tools", false);
}
if (document.getElementById("Ctools").checked) {
  await addFilesFromFolder(zip, "assets/minecraft/optifine/cit/customenchantments", true);
}
if (document.getElementById("Carmor_icons").checked) {
  await addFilesFromFolder(zip, "assets/minecraft/optifine/cit/customenchantments", true);
}
if (document.getElementById("Carmor_models").checked) {
  await addFilesFromFolder(zip, "assets/minecraft/optifine/cit/customenchantments", true);
}

      const blob = await zip.generateAsync({ type: "blob" });
      saveAs(blob, "texture pack test.zip");
    });

    // Load ores suboptions at page load
    loadSubOptions("assets/minecraft/textures/block", "ores-sub", "ores");
  </script>
</body>
</html>
